가상 키보드가 필요해서 개발하게 되었다.
대략적으로 필요한 기능들이 있었는데, 일단은 가장 크게 한글 입력이 가능해야 했다.

한글 입력이 가능한 가상 키보드를 구현한 사례는 많이 찾을 수 있었으나, 대부분 react로 개발되어 있어 업무에 적용하기는 어려웠다.
회사에서 쓰는 프로그램 특성상 프론트엔드 프레임워크를 적용하기에는 무리가 있기 때문인데, 그래서 VanillaJS로 개발을 진행하였다.

시간이 부족했기 때문에 기본적으로 버튼이 생성되고, 어느정도 UI도 구성이 되어 있는 라이브러리를 사용해야겠다고 생각이 들었다.
찾아보다가 기본적인 기능이 잘 구현된 가상 키보드 라이브러리인 simple-keyboard를 이용했다.
https://github.com/hodgef/simple-keyboard


다만 이 라이브러리가 아쉬운 점은 한글 입력도 layout으로 제공하고 있지만 글자 추천 방식으로 메시지를 띄우고 이를 유저가 선택해야만 초성/중성/종성이 결합되어 한 단어가 되기 때문에, 만들고 있는 프로그램에 적용하기 적합하지 않았다.

예컨대 simple-keyboard.js는 "안"을 치면 "아ㄴ"이 input에 value로 일단 입력되고, "안"을 추천하는 말풍선을 띄운 후 이를 유저가 직접 선택 하라고 뜨는 방식인데 우리는 그냥 "안"을 치면 그냥 "안"이라고 보여줘야 했다.

한글 입력 기능을 좀 수정하기 위해 Hangul.js 도 사용하였다.
입력된 글자의 자모를 분리하여 초성-중성-종성을 구분한 뒤, 다시 조합해주는 라이브러리이다.


두 라이브러리를 사용해 구현해보니 어째서인지 "안녕하세요" 라고 나와야 할 값이 "아ㄴ녀ㅇ하세요" 라고 나오는 문제가 발생했다.

그런데 또, 가상키보드가 아니라 실제 나의 키보드로 자모를 입력 후 Hangul.assemble을 하면 정상적으로 동작을 하는 것이었다.

똑같이 생겼는데 어째서 동작이 다를까?
가상 키보드에서 입력한 자모의 UTF-16 코드값과
내 키보드에서 입력한 자모의 UTF-16 코드값을
charCodeAt() 을 이용해 출력해보았다.

가상키보드에서 입력한 자음 ㅇ과
내 키보드로 입력한 자음 ㅇ의 코드값이 달랐다.

찾아보니 한글 자모의 초성-중성-종성에 따라 유니코드가 달랐다.


0진수값  자음  10진수값  자음

4352  ㄱ  12593  ㄱ

4353  ㄲ  12594  ㄲ

4354  ㄴ  12595  ㄳ

4355  ㄷ  12596  ㄴ

4356  ㄸ  12597  ㄵ

4357  ㄹ  12598  ㄶ

4358  ㅁ  12599  ㄷ

4359  ㅂ  12600  ㄸ

4360  ㅃ  12601  ㄹ

4361  ㅅ  12602  ㄺ

4362  ㅆ  12603  ㄻ

4363  ㅇ  12604  ㄼ

4364  ㅈ  12605  ㄽ

4365  ㅉ  12606  ㄾ

4366  ㅊ  12607  ㄿ

4367  ㅋ  12608  ㅀ

4368  ㅌ  12609  ㅁ

4369  ㅍ  12610  ㅂ

4370  ㅎ  12611  ㅃ

12612  ㅄ

12613  ㅅ

12614  ㅆ

12615  ㅇ

12616  ㅈ

12617  ㅉ

12618  ㅊ

12619  ㅋ

12620  ㅌ

12621  ㅍ

12622  ㅎ

  

=================== 추 가 ====================================

  

초성 중성 종성

10진수값  자음  10진수값  자음 10진수값 자음

4352  ㄱ  4449 ᅡ 4520  ᆨ

4353  ㄲ  4450 ᅢ 4521  ᆩ

4354  ㄴ  4451 ᅣ 4522  ᆪ

4355  ㄷ  4452 ᅤ 4523  ᆫ

4356  ㄸ  4453 ᅥ 4524  ᆬ

4357  ㄹ  4454 ᅦ 4525  ᆭ

4358  ㅁ  4455 ᅧ 4526  ᆮ

4359  ㅂ  4456 ᅨ 4527  ᆯ

4360  ㅃ  4457 ᅩ 4528  ᆰ

4361  ㅅ  4458 ᅪ 4529  ᆱ

4362  ㅆ  4459 ᅫ 4530  ᆲ

4363  ㅇ  4460 ᅬ 4531  ᆳ

4364  ㅈ  4461 ᅭ 4532  ᆴ

4365  ㅉ  4462 ᅮ 4533  ᆵ

4366  ㅊ  4463 ᅯ 4534  ᆶ

4367  ㅋ  4464 ᅰ 4535  ᆷ

4368  ㅌ  4465 ᅱ 4536  ᆸ

4369  ㅍ  4466 ᅲ 4537  ᆹ

4370  ㅎ  4467 ᅳ 4538  ᆺ

4468 ᅴ 4539 ᆻ

4469 ᅵ 4540  ᆼ

4541  ᆽ

4542 ᆾ

4543  ᆿ

4544  ᇀ

4545  ᇁ

4546  ᇂ

  

종성 중성

10진수값 자음 10진수값 자음

12593  ㄱ 12623  ㅏ

12594  ㄲ 12624  ㅐ

12595  ㄳ 12625  ㅑ

12596  ㄴ 12626  ㅒ

12597  ㄵ 12627  ㅓ

12598  ㄶ 12628 ㅔ

12599  ㄷ 12629 ㅕ

12600  ㄸ 12630 ㅖ

12601  ㄹ 12631 ㅗ

12602  ㄺ 12632 ㅘ

12603  ㄻ 12633 ㅙ

12604  ㄼ 12634 ㅚ

12605  ㄽ 12635 ㅛ

12606  ㄾ 12636 ㅜ

12607  ㄿ 12637 ㅝ

12608  ㅀ 12638 ㅞ

12609  ㅁ 12639 ㅟ

12610  ㅂ 12640 ㅠ

12611  ㅃ 12641 ㅡ

12612  ㅄ 12642 ㅢ

12613  ㅅ 12643 ㅣ

12614  ㅆ

12615  ㅇ

12616  ㅈ

12617  ㅉ

12618  ㅊ

12619  ㅋ

12620  ㅌ

12621  ㅍ

12622  ㅎ

simple-keyboard.js는 키보드의 한글 자음은 초성 유니코드가 입력되도록 되어있고 모음은 중성 유니코드가 적용되어 있었다.

그렇다면 가상 키보드 클릭 시 입력되는 자음과 모음의 유니코드를 키보드 입력과 동일한 유니코드로 변경하면 되지 않을까? 해서 layout 내에 있는 유니코드를 모두 변경하였다.


정상적으로 동작한다.

이 경우에 대한 설명은 다음 포스트에서 작성한다. 





